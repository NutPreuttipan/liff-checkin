<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Squard Check-in System</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        button { padding: 15px 30px; margin: 10px; font-size: 18px; cursor: pointer; border-radius: 8px; border: none; color: white; }
        .btn-in { background-color: #28a745; }
        .btn-out { background-color: #dc3545; }
    </style>
</head>
<body>
    <h2>ระบบบันทึกเวลา</h2>
    <div id="user">กำลังโหลดข้อมูล...</div>
    <br>
    <button class="btn-in" onclick="getLocation('Check-in')">Check-in</button>
    <button class="btn-out" onclick="getLocation('Check-out')">Check-out</button>

    <script>
        const LIFF_ID = '2008881601-Dg4CmxGP';
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzOyzam4xWr4lNbXPLMxzuw5z_x34S3w-bpeNlaol59akczPvDO0d4wjbfbc2wJaJ8dJg/exec';

        async function main() {
            await liff.init({ liffId: LIFF_ID });
            if (liff.isLoggedIn()) {
                const profile = await liff.getProfile();
                document.getElementById('user').innerText = "สวัสดีคุณ " + profile.displayName;
            } else {
                liff.login();
            }
        }
        main();

        function getLocation(type) {
            if (confirm('ยืนยันการ ' + type)) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    sendData(type, lat, lng);
                }, (err) => {
                    alert('กรุณาอนุญาตการเข้าถึง GPS');
                });
            }
        }

        async function sendData(type, lat, lng) {
            const profile = await liff.getProfile();
            fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({
                    userId: profile.userId,
                    type: type,
                    lat: lat,
                    lng: lng
                })
            }).then(() => {
                // if (response == 'Success') {
                    alert('บันทึก ' + type + ' สำเร็จ!');
                    liff.closeWindow();
                // } else {
                //     alert('บันทึกไม่สำเร็จ: ' + response)
                // }
            }).catch(err => alert('เกิดข้อผิดพลาด: ' + err));
        }
    </script>
</body>
</html>













